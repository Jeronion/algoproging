
Разностный массив — это простой, но очень мощный приём, основанный на [[префиксные суммы]] который позволяет **быстро применять массовые изменения на отрезках** и **эффективно отвечать на запросы**. Он особенно полезен в алгоритмических задачах, где есть много операций вида «прибавить значение на диапазоне».

---

## Когда нужен разностный массив

Используй разностный массив, если:

- есть массив длины `N`
- есть **много операций** изменения значений **на отрезках**
- или нужно узнать, **сколько отрезков покрывают точку**

Типичные формулировки задач:

- «На отрезке `[l, r]` увеличить значения на `k`»
- «Сколько отрезков покрывают точку `x`?»
- «Толщина покрытия в каждой точке»

---

## Проблема наивного подхода

Допустим, есть массив длины `N`, и операция:

> увеличить все элементы от `l` до `r`

Наивно это делается за `O(r - l + 1)`.  
Если таких операций много — решение становится слишком медленным.

---

## Идея разностного массива

Вместо хранения **самих значений**, мы храним **разницу между соседними элементами**.

### Определение

Пусть есть массив `A`.  
Тогда разностный массив `D`:

```
D[1] = A[1]
D[i] = A[i] - A[i - 1]
```

Обратное восстановление:

```
A[i] = D[1] + D[2] + ... + D[i]
```

То есть **обычный массив — это префиксная сумма разностного**

---

## Магия обновлений диапазона

Если нужно увеличить все `A[l..r]` на `k` достаточно сделать:

```
D[l] += k
D[r + 1] -= k
```

И всё. Мы не трогаем весь диапазон — только **две ячейки**.

---

## Почему это работает

При восстановлении массива префиксной суммой:

- начиная с `l` значение увеличится на `k`
- после `r` увеличение «отменится»

Это похоже на включатель/выключатель.

---

## Пример

### Условие

Массив длины `10`, изначально все нули.

Операции:

1. `[2, 5] += 3`
2. `[4, 7] += 2`

### Разностный массив

```
index: 1 2 3 4 5 6 7 8
D:     0 3 0 2 0 -3 0 -2
```

### Восстановление

Префиксная сумма:

```
A: 0 3 3 5 5 2 2 0
```

---

## Задача «Носки» — классический пример

Есть `N` отрезков `[l, r]` — носки.

Нужно узнать сколько носков покрывают каждую точку

### Решение

```python
L, N, M = map(int, input().split())

diff = [0] * (L + 2)

for _ in range(N):
    l, r = map(int, input().split())
    diff[l] += 1
    diff[r + 1] -= 1

cover = [0] * (L + 1)
cur = 0
for i in range(1, L + 1):
    cur += diff[i]
    cover[i] = cur

for _ in range(M):
    x = int(input())
    print(cover[x])
```

---

## Временная сложность

|Операция|Сложность|
|---|---|
|Обработка отрезков|`O(N)`|
|Построение массива|`O(L)`|
|Ответы на запросы|`O(M)`|

---

## Заключение

Разностный массив — простой и мощный инструмент для работы с диапазонными обновлениями: изменение за $O(1)$, восстановление через префиксные суммы. Важно не забывать про `r + 1`, корректный размер массива и индексацию. Часто применяется в задачах на интервалы, события и расписания — must-have для олимпиад и контестов.