# Перечисление бинарных деревьев


## Что такое бинарное дерево?

**Бинарное дерево** — это структура данных, в которой каждый узел имеет не более двух потомков: левый и правый.

* Дерево называется **помеченным (labelled)**, если каждому узлу присвоена метка (например, A, B, C или числа).
* Дерево называется **непомеченным (unlabelled)**, если узлы не имеют меток — важна только структура.

### Пример

Два дерева считаются **одинаковыми**, если они совпадают по структуре (для непомеченных деревьев).

Два дерева считаются **разными**, если различаются метками (для помеченных деревьев), даже если структура одинакова.

---

## Сколько существует различных непомеченных бинарных деревьев с `n` узлами?

Обозначим через **T(n)** количество непомеченных бинарных деревьев с `n` узлами.

### Базовые случаи

* `T(0) = 1` — пустое дерево
* `T(1) = 1`
* `T(2) = 2`

### Примеры

#### n = 1

Существует одно дерево.

#### n = 2

Существует два дерева:

* узел с левым потомком
* узел с правым потомком

#### n = 3

Существует **5** различных деревьев.

---

## Рекуррентная формула

Идея подсчёта:

Если выбрать один узел корнем, то оставшиеся `n−1` узлов нужно распределить между левым и правым поддеревьями.

Пусть:

* `i` узлов в левом поддереве
* `n−1−i` узлов в правом поддереве

Тогда общее количество:

```
T(n) = Σ T(i) · T(n−1−i)
       i=0..n−1
```

Или эквивалентно:

```
T(n) = Σ T(i−1) · T(n−i)
       i=1..n
```

---

## Пример вычислений

### T(3)

```
T(3) = T(0)·T(2) + T(1)·T(1) + T(2)·T(0)
     = 1·2 + 1·1 + 2·1
     = 5
```

### T(4)

```
T(4) = T(0)·T(3) + T(1)·T(2) + T(2)·T(1) + T(3)·T(0)
     = 1·5 + 1·2 + 2·1 + 5·1
     = 14
```

---

## Связь с числами Каталана

Полученная последовательность:

```
1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, ...
```

Это **числа Каталана**.

Обозначим `Cₙ` — n-е число Каталана.

Тогда:

```
T(n) = Cₙ
```

---

## Формула n-го числа Каталана

Число Каталана можно вычислить напрямую:

```
T(n) = Cₙ = (2n)! / ((n+1)! · n!)
```

---

## Связь с бинарными деревьями поиска (BST)

Количество различных **бинарных деревьев поиска (BST)** с `n` ключами также равно числу Каталана.

Почему?

Если выбрать i-й ключ (в отсортированном порядке) корнем:

* `i−1` ключей попадут в левое поддерево
* `n−i` ключей — в правое

Количество способов снова описывается той же рекуррентной формулой.

Следовательно:

```
Количество BST с n узлами = Cₙ
```

---

# Сколько существует помеченных бинарных деревьев?

Для каждого непомеченного дерева с `n` узлами можно расставить метки `n!` способами.

Следовательно:

```
Количество помеченных деревьев =
(Количество непомеченных) × n!
```

Подставляем формулу Каталана:

```
= [(2n)! / ((n+1)! · n!)] × n!
```

---

## Пример

Для `n = 3`:

* Непомеченных деревьев: `5`
* Возможных перестановок меток: `3! = 6`

Итого:

```
5 × 6 = 30
```

Существует **30 различных помеченных бинарных деревьев** с тремя узлами.

---

# Итог

* Количество **непомеченных бинарных деревьев** с `n` узлами равно числу Каталана `Cₙ`.
* Количество **помеченных бинарных деревьев** равно `Cₙ × n!`.
* Количество **BST** с `n` ключами также равно `Cₙ`.

---

Если нужно, могу добавить:

* доказательство формулы,
* вывод формулы Каталана,
* асимптотику,
* реализацию на C++ / Python,
* визуализации для Obsidian (Mermaid).
